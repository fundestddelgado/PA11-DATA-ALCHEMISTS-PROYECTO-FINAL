<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Clasificador de Im√°genes</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(168, 85, 247, 0.5); }
      50% { box-shadow: 0 0 30px rgba(168, 85, 247, 0.8); }
    }
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-8px); }
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    .pulse-glow { animation: pulse-glow 2s infinite; }
    .float-animation { animation: float 3s ease-in-out infinite; }
    .bar-animate {
      transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-indigo-950 text-slate-100">

  <div class="max-w-6xl mx-auto px-6 py-12">

    <!-- HEADER -->
    <header class="text-center mb-12">
      <div class="inline-block mb-4">
        <div class="w-16 h-16 rounded-full bg-gradient-to-br from-fuchsia-500 via-purple-500 to-cyan-500 
                    flex items-center justify-center text-2xl pulse-glow">
          üñºÔ∏è
        </div>
      </div>
      <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight
                 bg-gradient-to-r from-fuchsia-400 via-purple-400 to-cyan-400
                 bg-clip-text text-transparent drop-shadow-lg">
        Clasificador de Im√°genes
      </h1>
      <p class="mt-4 text-slate-300 text-lg max-w-2xl mx-auto">
        Carga una imagen y nuestro modelo de IA te dir√° si es
        <span class="text-cyan-400 font-semibold">üì± Electr√≥nica</span> o
        <span class="text-purple-400 font-semibold">üéÆ Videojuegos</span>
      </p>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">

      <!-- SUBIR IMAGEN -->
      <section class="rounded-3xl p-6 border border-slate-800 bg-slate-900/60 backdrop-blur-xl shadow-2xl">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-fuchsia-500 to-purple-600 flex items-center justify-center">
            üì§
          </div>
          <div>
            <h2 class="text-xl font-semibold">Sube tu imagen</h2>
            <p class="text-sm text-slate-400">JPG, PNG o WebP</p>
          </div>
        </div>

        <!-- INPUT -->
        <label class="mt-4 block border-2 border-dashed border-purple-500/40
                      rounded-2xl p-8 text-center cursor-pointer
                      hover:border-purple-400 transition">
          <input id="fileInput" type="file" accept="image/*" class="hidden"/>
          <p class="text-purple-400 font-semibold">+ Selecciona una imagen</p>
          <p class="text-xs text-slate-500 mt-1">o arrastra aqu√≠</p>
        </label>

        <!-- PREVIEW -->
        <div class="mt-6 rounded-2xl border border-slate-800 bg-slate-950/60 p-4">
          <div class="flex justify-between items-center mb-2">
            <span class="text-sm text-slate-300">Vista previa</span>
            <span id="status"
              class="text-xs px-3 py-1 rounded-full bg-slate-800 text-slate-200">
              Listo
            </span>
          </div>

          <div class="aspect-video rounded-xl bg-slate-900 border border-slate-800
                      flex items-center justify-center overflow-hidden">
            <img id="preview" class="hidden max-h-full max-w-full"/>
            <span id="placeholder" class="text-slate-500 text-sm">
              Sin imagen seleccionada
            </span>
          </div>

          <button id="predictBtn"
            class="mt-6 w-full py-3 rounded-xl font-semibold text-white
                   bg-gradient-to-r from-purple-600 to-fuchsia-600
                   hover:opacity-90 transition
                   disabled:opacity-40 disabled:cursor-not-allowed">
            PREDICIR
          </button>
        </div>
      </section>

      <!-- RESULTADOS -->
      <section class="rounded-3xl p-6 border border-slate-800 bg-slate-900/60 backdrop-blur-xl shadow-2xl h-fit">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-lg">
            üìä
          </div>
          <div>
            <h2 class="text-xl font-semibold">Resultados</h2>
            <p class="text-sm text-slate-400">An√°lisis de confianza</p>
          </div>
        </div>

        <!-- RESULTADO PRINCIPAL -->
        <div class="mb-8 rounded-2xl border-2 border-slate-700 bg-gradient-to-br from-slate-800/80 to-slate-900/60 p-8 text-center">
          <p class="text-xs text-slate-400 uppercase tracking-wider mb-3 font-semibold">Predicci√≥n Final</p>
          <div id="topEmoji" class="text-7xl float-animation mb-4">üîç</div>
          <p id="topClass" class="text-4xl font-black bg-gradient-to-r from-fuchsia-400 to-cyan-400 bg-clip-text text-transparent mb-2">
            ‚Äî
          </p>
          <p id="topConfidence" class="text-lg text-slate-300">Confianza: ‚Äî</p>
        </div>

        <!-- BARRAS DE CONFIANZA -->
        <div id="bars" class="space-y-4 mt-6"></div>
      </section>

    </main>
  </div>

<script>
  const API_URL = "http://localhost:8000/predict";
  
  const CATEGORIES = {
    "electronics": { label: "üì± Electr√≥nica", color: "from-cyan-500 to-blue-600", emoji: "üì±" },
    "videogames": { label: "üéÆ Videojuegos", color: "from-purple-500 to-indigo-600", emoji: "üéÆ" }
  };

  const fileInput = document.getElementById("fileInput");
  const preview = document.getElementById("preview");
  const placeholder = document.getElementById("placeholder");
  const predictBtn = document.getElementById("predictBtn");
  const statusEl = document.getElementById("status");
  const barsEl = document.getElementById("bars");
  const topClassEl = document.getElementById("topClass");
  const topConfidenceEl = document.getElementById("topConfidence");
  const topEmojiEl = document.getElementById("topEmoji");

  let selectedFile = null;

  function setStatus(text, type="idle") {
    statusEl.textContent = text;
    statusEl.className = "text-xs px-3 py-1 rounded-full ";
    if (type === "loading") statusEl.className += "bg-amber-500/20 text-amber-300";
    else if (type === "ok") statusEl.className += "bg-emerald-500/20 text-emerald-300";
    else if (type === "error") statusEl.className += "bg-red-500/20 text-red-300";
    else statusEl.className += "bg-slate-800 text-slate-200";
  }

  function renderBars(results) {
    barsEl.innerHTML = "";
    
    if (!results || Object.keys(results).length === 0) {
      return;
    }
    
    let maxCategory = null;
    let maxValue = 0;
    
    Object.keys(results).forEach(cat => {
      const val = results[cat] ?? 0;
      if (val > maxValue) {
        maxValue = val;
        maxCategory = cat;
      }
    });

    Object.keys(results).forEach((cat, idx) => {
      const val = results[cat] ?? 0;
      const catInfo = CATEGORIES[cat] || { 
        label: cat, 
        color: "from-slate-500 to-slate-600", 
        emoji: "‚ùì" 
      };
      const isMax = cat === maxCategory;
      
      const row = document.createElement("div");
      row.className = `rounded-2xl p-4 border-2 transition-all ${
        isMax 
          ? "border-purple-400 bg-slate-800/60 ring-2 ring-purple-400/30" 
          : "border-slate-800 bg-slate-950/60"
      }`;
      row.style.animationDelay = `${idx * 0.1}s`;
      row.style.animation = "slideIn 0.5s ease-out forwards";
      
      row.innerHTML = `
        <div class="flex justify-between items-center mb-3">
          <div class="flex items-center gap-2">
            <span class="text-2xl">${catInfo.emoji}</span>
            <span class="font-semibold">${catInfo.label}</span>
          </div>
          <span class="px-3 py-1 rounded-lg bg-gradient-to-r ${catInfo.color} text-white text-sm font-bold">
            ${val.toFixed(1)}%
          </span>
        </div>
        <div class="h-4 bg-slate-900 rounded-full overflow-hidden border border-slate-800">
          <div class="h-full bg-gradient-to-r ${catInfo.color} bar-animate"
               style="width:${Math.min(100, val)}%"></div>
        </div>
      `;
      barsEl.appendChild(row);
    });

    if (maxCategory) {
      const catInfo = CATEGORIES[maxCategory] || { 
        label: maxCategory, 
        emoji: "‚ùì" 
      };
      topClassEl.textContent = catInfo.label;
      topConfidenceEl.textContent = `Confianza: ${maxValue.toFixed(1)}%`;
      topEmojiEl.textContent = catInfo.emoji;
    }
  }

  renderBars({});

  fileInput.addEventListener("change", e => {
    selectedFile = e.target.files[0];
    if (!selectedFile) return;
    preview.src = URL.createObjectURL(selectedFile);
    preview.classList.remove("hidden");
    placeholder.classList.add("hidden");
    setStatus("Imagen lista", "ok");
  });

  predictBtn.addEventListener("click", async () => {
    if (!selectedFile) return setStatus("Selecciona una imagen", "error");
    predictBtn.disabled = true;
    setStatus("Prediciendo...", "loading");

    try {
      const fd = new FormData();
      fd.append("file", selectedFile);
      const res = await fetch(API_URL, { method: "POST", body: fd });
      if (!res.ok) throw new Error("HTTP " + res.status);
      const data = await res.json();
      
      if (data.success) {
        renderBars(data.results);
        setStatus("Listo", "ok");
      } else {
        setStatus("Error: " + (data.detail || data.error), "error");
      }
    } catch (e) {
      setStatus("Error en predicci√≥n", "error");
      console.error(e);
    } finally {
      predictBtn.disabled = false;
    }
  });
</script>

</body>
</html>